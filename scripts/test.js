
const calculator = require('../scripts/calculator');
//var sloc = [[36.13,-87.83],[40.64,-77.89],[28.11,-81.43]];
//var pts = ['2019-03-08T06:22:51.019538Z', '2019-03-08T06:23:47.019538Z', '2019-03-08T06:24:00.019538Z'];
//var sts = ['2019-03-08T06:23:27.019538Z', '2019-03-08T06:25:07.019538Z', '2019-03-08T06:25:31.019538Z'];
//var pts = ['2019-03-08T06:07:05.019538Z', '2019-03-08T06:10:03.019538Z', '2019-03-08T06:09:47.019538Z'];
//var sts = ['2019-03-08T06:07:43.019538Z', '2019-03-08T06:13:03.019538Z', '2019-03-08T06:15:33.019538Z'];
//var sloc = [[7.07,125.58],[22.28,114.14],[37.48,126.62]];


var pts = ['2019-03-15T06:22:51.019538Z' , '2019-03-15T06:22:52.019538Z' , '2019-03-15T06:23:34.019539Z'];
var sloc = [[36.13 , -87.83],[38.23 , -86.29],[38.06, -91.24]];
var sts = ['2019-03-15T06:23:27.019538Z' , '2019-03-15T06:23:29.019538Z' , '2019-03-15T06:24:44.019541Z'];
var d = [], pad=[], sad = [], parr = [], sarr = [];

//var v1 = [-4485,-5826,-5095,-5388,-3658,-5287,-6082,-3811,-5913,-5792,-6103,-8038,-7253,-7105,-6627,-5276,-3315,-2335,-2939,-3866,-5256,-7612,-10560,-10800,-8807,-7840,-7436,-5380,-3533,-4296,-5073,-4751,-4878,-6315,-7871,-7502,-7183,-6914,-5304,-4974,-6252,-7215,-6084,-5050,-5997,-6574,-5522,-3983,-7037,-7819];
//var v2 = [-4631,-4700,-4725,-4734,-4585,-4487,-4514,-4420,-4321,-4261,-4217,-4192,-4152,-4064,-3856,-3737,-3720,-3604,-3550,-3495,-3314,-3228,-3181,-3107,-3069,-2953,-2878,-2821,-2750,-2727,-2601,-2551,-2581,-2551,-2610,-2605,-2492,-2576,-2581,-2412,-2555,-2715,-2665,-2584,-2562,-2655,-2552,-2354,-2370,-2502];
//var v3 = [5602,5094,4993,6102,5732,5510,6593,5703,5612,6023,7100,7141,65186374,6840,8169,7439,8064,8551,7246,7518,7216,7388,6374,5816,7345,5762,5800,5986,5626,5856,5265,6242,5959,6301,6662,4240,4567,5339,3260,3935,4562,3517,3562,4561,4304,3453,3217,3553,5019];
//var v4 = [475463,445824,416674,385592,350516,306899,255980,202814,141049,76313,20516,-24080,-49325,-59805,-64899,-60964,-53803,-49429,-48234,-54099,-66878,-86585,-113478,-143483,-170861,-184050,-171693,-135988,-81348,-10711,64128,134163,192672,228259,239132,227130,187788,126099,50254,-37105,-128694,-220814,-311517,-394952,-461664,-501316,-515227,-507097,-482238,-452307];
//var v5 = [676,816,913,899,953,1039,1059,1136,1180,1215,1271,1250,1205,1189,1152,1062,997,929,842,849,784,677,737,735,627,521,438,487,479,335,333,411,341,216,119,-54,-224,-327,-446,-565,-692,-725,-805,-1020,-1055,-1079,-1243,-1295,-1233,-1135];
//var v6 = [3829,3927,3484,3257,3457,3675,3886,2921,2723,3791,3597,2756,2579,2271,3222,2761,415,2234,3613,1254,1011,1859,1441,1590,1611,865,954,1668,409,576,1797,166,1298,1425,110,1205,1352,1850,1303,2405,3107,1629,1946,3104,3605,2079,2272,3060];

var v3 = [-1664,-1654,-1678,-1667,-1676,-1696,-1679,-1689,-1700,-1699 ,-1712 ,-1712 ,-1704 ,-1720 ,-1725 ,-1711 ,-1732 ,-1744 ,-1753 ,-1767 ,-1744 ,-1746 ,-1743 ,-1730 ,-1759 ,-1759 ,-1738 ,-1732 ,-1721 ,-1720,-1721,-1719,-1709 ,-1693,-1674,-1667,-1673,-1655,-1647,-1631,-1606,-1605,-1601,-1599,-1592,-1569,-1551,-1531,-1510,-1506];
var v2 = [ -197 ,-74 ,-122 ,-206 ,-144 ,-168 ,-317 ,-322 ,-241 ,-256 ,-200 ,-150 ,-147 ,-60 ,3 ,33 ,113 ,274 ,409 ,455 ,573 ,704 ,751 ,820 ,944 ,1062 ,1163 ,1234 ,1285 ,1456 ,1598 ,1658 ,1778 ,1842 ,1898 ,1932 ,1987 ,2054 ,2057 ,2156 ,2200 ,2156 ,2167 ,2167 ,2182 ,2261 ,2238 ,2196 ,2190 ,2172];
var v1 = [ -597 ,-611 ,-607 ,-622 ,-642 ,-645 ,-656 ,-655 ,-648 ,-664 ,-670 ,-666 ,-674 ,-663 ,-647 ,-649 ,-637 ,-614 ,-604 ,-605 ,-617 ,-610 ,-592 ,-587 ,-567 ,-568 ,-587 ,-572 ,-575 ,-587 ,-575 ,-566 ,-562 ,-554 ,-549 ,-552 ,-551 ,-549 ,-536 ,-510 ,-507 ,-504 ,-495 ,-490 ,-479 ,-480 ,-487 ,-483 ,-468 ,-452];
var v6 = [ -657 ,-658 ,-640 ,-653 ,-641 ,-613 ,-607 ,-636 ,-630 ,-620 ,-649 ,-628 ,-663 ,-670 ,-647 ,-670 ,-634 ,-681 ,-695 ,-619 ,-686 ,-700 ,-643 ,-727 ,-712 ,-673 ,-733 ,-684 ,-733 ,-739 ,-688 ,-770 ,-722 ,-737 ,-774 ,-723 ,-784 ,-795 ,-772 ,-828 ,-838 ,-816 ,-865 ,-845 ,-829 ,-874 ,-830 ,-882 ,-906 ,-864];
var v5 = [ 696 ,749 ,686 ,797 ,808 ,807 ,773 ,680 ,723 ,508 ,479 ,448 ,323 ,367 ,382 ,330 ,248 ,216 ,148 ,155 ,36 ,-46 ,-8 ,-205 ,-164 ,-261 ,-371 ,-343 ,-375 ,-485 ,-556 ,-478 ,-448 ,-475 ,-513 ,-593 ,-584 ,-527 ,-508 ,-632 ,-624 ,-491 ,-502 ,-512 ,-595 ,-630 ,-600 ,-525 ,-468 ,-555];
var v4 = [ -557 ,-578 ,-580 ,-554 ,-554 ,-564 ,-566 ,-575 ,-566 ,-554 ,-566 ,-565 ,-563 ,-570 ,-565 ,-556 ,-567 ,-585 ,-571 ,-561 ,-582 ,-599 ,-605 ,-604 ,-596 ,-596 ,-593 ,-596 ,-621 ,-614 ,-615 ,-636 ,-623 ,-622 ,-617 ,-606 ,-619 ,-623 ,-630 ,-633 ,-634 ,-636 ,-628 ,-631 ,-622 ,-604 ,-613 ,-626 ,-622 ,-614];



d1 = calculator.integrateVelocity(v1);
d2 = calculator.integrateVelocity(v2);
d3 = calculator.integrateVelocity(v3);
d4 = calculator.integrateVelocity(v4);
d5 = calculator.integrateVelocity(v5);
d6 = calculator.integrateVelocity(v6);

console.log(d1, d2, d3, d4, d5, d6);
dp = Math.max(d4, d5, d6);
console.log("DP = " + dp)
 for (i = 0; i < pts.length; i++) {
                    parr[i] = convertToTime(pts[i]);
                    sarr[i] = convertToTime(sts[i]);
                }
//Sensor distances
d[0] = calculator.getCoordinateDistance(sloc[0], sloc[1]);
d[1] = calculator.getCoordinateDistance(sloc[0], sloc[2]);
d[2] = calculator.getCoordinateDistance(sloc[1], sloc[2]);
console.log("d = " + d);
//P-wave Arrival Difference
pad[0] = calculator.getTimeDifference(parr[0], parr[1]);
pad[1] = calculator.getTimeDifference(parr[0], parr[2]);
pad[2] = Math.abs(calculator.getTimeDifference(parr[1], parr[2]));
console.log("pad = " + pad);
//S-wave Arrival Difference
sad[0] = calculator.getTimeDifference(sarr[0], sarr[1]);
sad[1] = calculator.getTimeDifference(sarr[0], sarr[2]);
sad[2] = calculator.getTimeDifference(sarr[1], sarr[2]);
console.log("sad = " + sad);
/*
for(i = 0; i < pad.length; i++ ){ 
pad[i] = Math.abs(pad[i]);
sad[i] = Math.abs(sad[i]);
}*/
//Estimate P wave Velocity
var vp1 = calculator.getEstimatedVelocity(d[0], pad[0]);
var vp2 = calculator.getEstimatedVelocity(d[1], pad[1]);
var vp3 = calculator.getEstimatedVelocity(d[2], pad[2]);
console.log("vp = " + vp1 + " " + vp2 + " " + vp3);

vp = (vp1 + vp2 + vp3)/3;
//Estimate S wave Velocity
var vs1 = calculator.getEstimatedVelocity(d[0], sad[0]);
var vs2 = calculator.getEstimatedVelocity(d[1], sad[1]);
var vs3 = calculator.getEstimatedVelocity(d[2], sad[2]);
console.log("vs = " + vs1 + " " + vs2 + " " + vs3);

vs = (vs1 + vs2 + vs3)/3;

console.log(parr[0]-sarr[0]);
console.log(parr[1]-sarr[1]);
console.log(parr[2]-sarr[2]);
//Distance to epicenter
var ed1 = calculator.getEpicenterDistance(parr[0], sarr[0], vp1, vs1);
var ed2 = calculator.getEpicenterDistance(parr[1], sarr[1], vp1, vs1);
var ed3 = calculator.getEpicenterDistance(parr[2], sarr[2], vp2, vs2);

var mL1 = calculator.getMagnitude(dp, ed1);
var mL2 = calculator.getMagnitude(dp, ed2);
var mL3 = calculator.getMagnitude(dp, ed3);
console.log("M = " + mL1 + " "+mL2 +" "+ mL3)

console.log("d1 = " + ed1);
console.log("d2 = " + ed2);
console.log("d3 = " + ed3);

//var epicenter = calculator.getEpicenter(sloc[0],sloc[1],sloc[2],ed1,ed2,ed3);
//console.log(epicenter);

function convertToTime(timestamp) {
    date = new Date(timestamp);
    time = date.getTime();
    return time;
}


