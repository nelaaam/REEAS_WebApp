
const db = require('../config/connection');
const Joi = require('joi');
const mysql = require('mysql');
const calculator = require('../scripts/calculator');
var i;
//prepare query
var sql1 = "SELECT DISTINCT sensor_id, timestamp FROM Displacement_Record WHERE wave_type = 1 ORDER BY timestamp ASC";
var sql2 = "SELECT timestamp FROM Displacement_Record WHERE wave_type = 0 AND sensor_id = ?";
var sql3 = "SELECT latitude, longitude FROM Sensor_Record WHERE sensor_id = ?";
var sensor = [], pTime = [];
//connect to database
db.getConnection((err, conn) => {
    if (err) throw err;
    conn.query(sql1, function (err, res, fields) {
console.log(res);
        for(i=0; i<res.length; i++){
            sensor[i] = res[i].sensor_id;
            pTime[i] = res[i].timestamp;           
}
for(i=0; i<sensor.length; i++) {
            conn.query(sql2, function (err, results, fields){
                if (err) throw err;
                sTime[i] = results[i].timestamp;
                conn.query(sql3, 1, function(err, rows, fields){
                    if (err) throw err;
console.log(rows[0].latitude);                   // var location = [rows[i].latitude, rows[i].longitude];
console.log({ sensor, pTime, sTime });
            });
});
}
   });
conn.release();
});
